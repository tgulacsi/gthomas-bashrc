#!/bin/sh
#which mlterm >&2 && exec mlterm -j blend -e /bin/bash --login
#which kitty >&2 && exec kitty -1 --instance-group default --detach -e /bin/bash --login
#set -x
#which kitty >&2 && exec kitty -e /bin/bash
#if [ ! -d /usr/share/fonts/firacode/ ]; then
#	sudo apt install fonts-firacode
#fi
have_foot=0
if which foot 2>&1; then
    have_foot=1
fi
if [ $have_foot -eq 1 ] && [ -e "$XDG_RUNTIME_DIR/foot-$WAYLAND_DISPLAY.sock" ] && ps -ef|grep -qE 'foot (-s|--server)'; then
	exec footclient --login-shell /bin/bash 
fi

font=
for fn in 'Go Mono' 'Iosevka Term' 'Fira Code'; do
	font="$(fc-list "$fn":Regular family)"
	if [ -n "$font" ]; then
		break
	fi
done
echo "# font=$font" >&2
if [ -z "$font" ]; then
	font='Go Mono'
fi
fontsize=10
monitor="$(swaymsg -t get_outputs | jq -r '.[] | select(.focused) | .model + ": " + (.current_mode.width | tostring) + "x" + (.current_mode.height | tostring)')" 
case "$monitor" in
	LG\ ULTRAWIDE:*) fontsize=14 ;;
    SA300/SA350:*) fontsize=12 ;;
    *) echo "monitor=$monitor" ;;
esac
if [ $have_foot -eq 1 ]; then
    set -x
    exec foot --server --font="${font}:size=${fontsize},forkawesome:size=${fontsize},FontAwesome:size=${fontsize},Noto Sans:size=${fontsize}"
fi
which stterm 2>&1 && exec stterm -f "$font:pixelsize=$fontsize" -e /bin/bash --login
which lxterm 2>&1 && exec lxterm -f "$font:pixelsize=$fontsize" -e /bin/bash --login
which mlterm-wl >&2 && exec mlterm-wl "-deffont=$font" -w $fontsize --sb=false --bel=visual --clip=false -e /bin/bash --login
which alacritty >&2 && exec alacritty -e /bin/bash --login
urxvtc "$@"
if [ $? -eq 2 ]; then
	urxvtd -q -o -f
	urxvtc "$@"
fi
