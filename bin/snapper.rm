#!/bin/sh
all=0
if [ "$1" = --all ]; then
	all=1
	shift
fi
CONFIG=${CONFIG:-$1}
if [ -z "$CONFIG" ]; then
	CONFIG=root
fi
if [ $all -eq 1 ]; then
	exec snapper -c $CONFIG delete $(snapper -c $CONFIG --disable-used-space list | cut -d\| -f2 | grep '^ [1-9]')
fi
snapper -c $CONFIG cleanup timeline
snapper -c $CONFIG cleanup number
exec snapper -c $CONFIG delete $(snapper -c $CONFIG --disable-used-space list | fgrep ' apt ' | cut -d\| -f2 | grep '^ [1-9]')
